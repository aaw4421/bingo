<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="../../img/favicon.ico">
    <title>Ocarina of Time Bingo - Settings</title>
    <style>
        h1 {
            color: #e09456;
            font-weight: bold;
            font-size: 22px;
        }

        h2 {
            color: #e09456;
            font-weight: bold;
            font-size: 16px;
        }

        html {
            font-family: Roboto;
            margin: 0;
            background: #111111;
            color: #bec7d2;
        }

        body {
            display: flex;
            flex-flow: column;
            margin: 10px 25px;
        }

        label {
            display: flex;
            flex-flow: row;
            align-items: center;
            margin: 10px 0px 10px 10px;
        }

        select {
            height: 21px;
            width: 85px;
            margin: 0 10px;
        }

        input {
            width: 45px;
            margin: 0 10px;
        }

        .button {
            background-color: #424242;
            background-image: linear-gradient(to bottom, #424242, #303030);
            border-width: 1px 0px 1px 1px;
            border-style: solid;
            border-color: #4c4c4c #000000 #000000 #474747;
            text-align: center;
            display: block;
            font-weight: 700;
            color: #bec7d2;
            float: left;
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            border-radius: 5px;
            user-select: none;
            cursor: pointer;
            width: 170px;
            margin: 5px 0px;
            padding: 4px 0;
        }

        .button:hover {
            background-color: #3c70df;
            background-image: linear-gradient(to bottom, #3c70df, #235cd4);
            border-width: 1px 0px 1px 1px;
            border-style: solid;
            border-color: #4e7de2 #102a63 #102a63 #4576e0;
            color: #ffffff;
        }

        .button:active {
            background-color: #1448b3;
            background-image: linear-gradient(to bottom, #1448b3, #103b93);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.6);
            border-width: 1px 0px 1px 1px;
            border-style: solid;
            border-color: #164fc5 #071a40 #071a40 #154cbc;
            color: #ffffff;
        }
    </style>
</head>

<body>

    <h1>Settings</h1>

    <form>
        <h2>Board</h2>

        <label for="language" class="setting">Language:
            <select id="language" width=800px>
                <option value="en">English</option>
                <option value="jp">Japanese</option>
            </select>
        </label>

        <label for="boardTheme" class="setting">Layout theme:
            <select id="boardTheme">
                <option value="classic">Classic</option>
                <option value="modern">Modern</option>
            </select>
        </label>

        <label for="boardPopoutWidth" class="setting">Popout width:
            <input id="boardPopoutWidth" class="num-input" type="number" min=500 max=1000 maxlength=4
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
        </label>

        <label for=boardPopoutHeight" class="setting">Popout height:
            <input id="boardPopoutHeight" class="num-input" type="number" min=450 max=1500 maxlength=4
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
        </label>

        <h2>Row</h2>

        <label for="rowPopoutWidth" class="setting">Popout width:
            <input id="rowPopoutWidth" class="num-input" type="number" min=200 max=1000 maxlength=4
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
        </label>

        <label for=rowPopoutHeight" class="setting">Popout height:
            <input id="rowPopoutHeight" class="num-input" type="number" min=320 max=1500 maxlength=4
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
        </label>
    </form>

    <div id="save-button" class="button">Save and go back</div>
    <div id="reset-button" class="button">Reset all to default</div>

</body>

<script src="./default-settings.js" type="text/javascript"></script>
<script>

    const storageItem = localStorage.getItem('bingo-settings');
    const storageData = storageItem ? JSON.parse(storageItem) : defaultSettings;
    console.log(storageData)

    function checkNumConstraints(obj) {
        if (obj.min && parseInt(obj.value) < parseInt(obj.min)) {
            obj.value = obj.min
        }
        if (obj.max && parseInt(obj.value) > parseInt(obj.max)) {
            obj.value = obj.max
        }
    }

    function resetAllValues() {
        for (setting in defaultSettings) {
            const settingStr = setting
            const settingObject = document.getElementById(settingStr);

            storageData[settingStr] = defaultSettings[settingStr];
            localStorage.setItem('bingo-settings', JSON.stringify(storageData));
            settingObject.value = storageData[settingStr]
        }
    }

    function addSettingEventListeners() {
        for (setting in defaultSettings) {
            const settingStr = setting
            console.log(settingStr)
            const settingObject = document.getElementById(settingStr);
            settingObject.addEventListener('change', () => {
                if (settingObject.type === 'number') {
                    checkNumConstraints(settingObject)
                }
                storageData[settingStr] = settingObject.value;
                localStorage.setItem('bingo-settings', JSON.stringify(storageData));
            });
            settingObject.value = storageData[settingStr]
        }
    }

    addSettingEventListeners();

    const resetButton = document.getElementById('reset-button')
    resetButton.addEventListener('click', () => {
        const resetValues = confirm("Are you sure you want to reset all the fields to the default value?");
        if (resetValues) {
            resetAllValues()
        }
    })

    const saveButton = document.getElementById('save-button')
    saveButton.addEventListener('click', () => {
        history.back()
    })

</script>

</html>